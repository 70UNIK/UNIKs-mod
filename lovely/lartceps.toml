[manifest]
version = "0.0.1"
dump_lua = true
priority = 999

### Epic Decision and Lartceps


### Brethren Moon: Force text to be red
[[patches]]
[patches.pattern]
target = '''functions/common_events.lua'''
pattern = '''    func = function()
        local col = G.C.GREEN'''
position = "after"
payload = '''
local forceRed = nil
if vals.colour then
    col = vals.colour
end
if vals.forceRed then
    forceRed = true
    col = G.C.RED
end
'''
match_indent = true

## Do not trigger booster pack tags after ending the baneful pack, otherwise it will be awkward
[[patches]]
[patches.pattern]
target = '''functions/button_callbacks.lua'''
pattern = '''if G.GAME.tags[i]:apply_to_run({type = 'new_blind_choice'}) then break end'''
position = "before"
payload = '''
	if not G.GAME.unik_mortons_fork then
'''
match_indent = true
[[patches]]
[patches.pattern]
target = '''functions/button_callbacks.lua'''
pattern = '''if G.GAME.tags[i]:apply_to_run({type = 'new_blind_choice'}) then break end'''
position = "after"
payload = '''
	end
'''
match_indent = true


##Part 1 of below:
[[patches]]
[patches.pattern]
target = '''functions/misc_functions.lua'''
pattern = '''--Control the music here'''
position = "before"
payload = '''
local disable_booster_music = false
local obj = SMODS.OPENED_BOOSTER
if obj and obj.config and obj.config.center and obj.config.center.no_music then
	disable_booster_music = true
end
'''
match_indent = true

## Force music to be Boss Blind music while in baneful pack
[[patches]]
[patches.pattern]
target = '''functions/misc_functions.lua'''
pattern = '''(G.booster_pack and not G.booster_pack.REMOVED and 'music2') or'''
position = "at"
payload = '''(G.booster_pack and not G.booster_pack.REMOVED and not disable_booster_music and 'music2') or'''
match_indent = true

[[patches]]
[patches.pattern]
target = '''functions/state_events.lua'''
pattern = '''-- TARGET: setting_blind effects'''
position = "after"
payload = '''if G.GAME.unik_mortons_fork then
    return true
end
'''
match_indent = true


### antifrustriation feature of booster
[[patches]]
[patches.pattern]
target = '''functions/button_callbacks.lua'''
pattern = '''G.GAME.pack_choices = G.GAME.pack_choices - 1'''
position = "after"
payload = '''
G.GAME.lartceps_pack_pity = G.GAME.lartceps_pack_pity or 4
G.GAME.lartceps_pack_pity = G.GAME.lartceps_pack_pity - 1
'''
match_indent = true

### antifrustriation feature of booster2: show how much you need to choose to skip
[[patches]]
[patches.regex]
target = '''=[SMODS _ "src/game_object.lua"]'''
pattern = '''\{(.*)nodes=\{
(.*)\{(.*)localize\('k_choose'\)..' '(.*)\},
(.*)\{(.*)\}\}\},'''
position = "after"
payload = '''
UNIK.display_skip_req(),
'''

### antifrustriation feature of booster2: show how much you need to choose to skip
[[patches]]
[patches.regex]
target = '''=[SMODS _ "src/game_object.lua"]'''
pattern = '''G\.booster\_pack\.alignment\.offset\.y = \-2\.2'''
position = "after"
payload = '''

G.booster_pack.alignment.offset.y = -2.2 - UNIK.display_skip_req_offset()
'''
